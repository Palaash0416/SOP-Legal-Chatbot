<!DOCTYPE html>
<html>
<head>
  <title>SOP Legal AI Assistant</title>
  <!-- Google Analytics -->
  {% raw %}
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-G-X5NL5N7FHV"></script>
  <script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-X5NL5N7FHV');
</script>
{% endraw %}
 <script>
  let userId = localStorage.getItem("sop_user_id") || null;
  let sessionState = "start";

  function login() {
    const u = document.getElementById("username").value;
    const p = document.getElementById("password").value;
    const terms = document.getElementById("terms-check").checked;
    if (!u || !p || !terms) {
      alert("Please complete all fields and agree to Terms.");
      return;
    }
    userId = "user_" + u;
    localStorage.setItem("sop_user_id", userId);
    document.getElementById("auth-section").classList.add("hidden");
    document.getElementById("chat-section").classList.remove("hidden");
    sendMessage("hello");
  }

  function sendMessage(txt = null) {
    const input = document.getElementById("user-input");
    const msg = txt || input.value;
    input.value = "";
    const chat = document.getElementById("chat-box");
    chat.innerHTML += `<div><strong>You:</strong> ${msg}</div>`;
    fetch("/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ user_id: userId, user_input: msg, session_state: sessionState })
    })
    .then(r => r.json())
    .then(d => {
      chat.innerHTML += `<div><strong>SOP:</strong> ${d.response}</div>`;
      if (d.response.includes("Would you like help from a professional"))
        sessionState = "handover_confirm";
      chat.scrollTop = chat.scrollHeight;
    });
  }
</script>
  <!-- AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXX"
     crossorigin="anonymous"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f9f9f9; }
    header, footer { background: #1d3557; color: white; padding: 1rem; text-align: center; }
    nav { background: #457b9d; padding: 0.5rem 1rem; display: flex; justify-content: space-between; }
    nav a { color: white; margin-right: 1rem; text-decoration: none; }
    main { max-width: 600px; margin: 2rem auto; padding: 1rem; background: white; border-radius: 8px; }
    .chat-box { border: 1px solid #ccc; padding: 1rem; height: 250px; overflow-y: scroll; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <header><h1>SOP Legal AI Assistant</h1></header>
  <nav>
    <div><a href="#">Home</a> <a href="#">About Us</a> <a href="#">Documents</a></div>
    <a href="/static/SOP_Legal_AI_Assistant_Terms_and_Privacy.pdf" target="_blank">Terms & Privacy</a>
  </nav>
  <main>
    <div id="auth-section">
      <h2>Sign Up / Sign In</h2>
      <input id="username" placeholder="Username" />
      <input id="password" type="password" placeholder="Password" />
      <label><input type="checkbox" id="terms-check" /> I agree to the <a href="/static/SOP_Legal_AI_Assistant_Terms_and_Privacy.pdf" target="_blank">Terms & Conditions</a></label>
      <button onclick="login()">Continue</button>
    </div>
    <div id="chat-section" class="hidden">
      <h2>Talk to SOP</h2>
      <div id="chat-box" class="chat-box"></div>
      <input id="user-input" placeholder="Type your question..." />
      <button onclick="sendMessage()">Send</button>
    </div>
    <div style="margin-top:20px;">
      <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-XXXXXXX"
         data-ad-slot="1234567890"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>
  </main>
  <footer>&copy; 2025 SOP Legal AI Assistant</footer>

{% raw %}
<script>
  let userId = localStorage.getItem("sop_user_id") || null;
  let sessionState = "start";

  function login() {
    const u = document.getElementById("username").value;
    const p = document.getElementById("password").value;
    const terms = document.getElementById("terms-check").checked;
    if (!u || !p || !terms) {
      alert("Please complete all fields and agree to Terms.");
      return;
    }

    userId = "user_" + u;
    localStorage.setItem("sop_user_id", userId);
    document.getElementById("auth-section").classList.add("hidden");
    document.getElementById("chat-section").classList.remove("hidden");
    sendMessage("hello");
  }

  function sendMessage(txt = null) {
    const input = document.getElementById("user-input");
    const msg = txt || input.value;
    input.value = "";
    const chat = document.getElementById("chat-box");
    chat.innerHTML += `<div><strong>You:</strong> ${msg}</div>`;
    fetch("/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ user_id: userId, user_input: msg, session_state: sessionState })
    })
    .then(r => r.json())
    .then(d => {
      chat.innerHTML += `<div><strong>SOP:</strong> ${d.response}</div>`;
      if (d.response.includes("Would you like help from a professional")) sessionState = "handover_confirm";
      chat.scrollTop = chat.scrollHeight;
    });
  }
</script>
{% endraw %}
</body>
</html>
